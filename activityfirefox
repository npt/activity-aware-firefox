#!/bin/bash
#
# Compatability for Firefox and KDE Plasma Activities
# 

ACTIVITY=$(qdbus org.kde.ActivityManager /ActivityManager/Activities CurrentActivity)
FF_FOLDER=$"$HOME/.mozilla/firefox"
DEF_PROF=$"$FF_FOLDER/????????.default-release"
NEW_PROF=$"$FF_FOLDER/????????.$ACTIVITY"

if [ -d $FF_FOLDER/????????.$ACTIVITY ];
then
        exec /usr/lib/firefox/firefox -P $ACTIVITY "$@" &
		echo ">>> started an existing profile: $ACTIVITY"

else
        /usr/lib/firefox/firefox --createprofile $ACTIVITY
		echo ">>> created a new profile: $ACTIVITY"
        cp -a $DEF_PROF/chrome $NEW_PROF/ # copy any custom user chrome, e.g. needed to hide the top tab-bar
		echo ">>> copied user chrome from default profile"
        exec /usr/lib/firefox/firefox -P $ACTIVITY "$@" &
		echo ">>> started the new profile: $ACTIVITY"

fi

exit
